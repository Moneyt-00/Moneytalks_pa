<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Payment Success | MoneyTalks</title>
<meta name="description" content="Payment successful confirmation page">

<!-- Security headers for production -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
    :root {
        --primary-color: #00ffae;
        --secondary-color: #8d4cff;
        --gradient-start: #00ffd6;
        --gradient-end: #4e3bff;
        --background-dark: #080c1d;
        --background-light: #120233;
        --glass-bg: rgba(255, 255, 255, 0.08);
        --glass-border: rgba(255, 255, 255, 0.15);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        margin: 0;
        padding: 20px;
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, var(--background-dark), var(--background-light) 60%, #060a18);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        overflow-x: hidden;
        position: relative;
    }

    .glass-card {
        width: 100%;
        max-width: 450px;
        background: var(--glass-bg);
        border-radius: 30px;
        padding: 40px 30px;
        text-align: center;
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 0 40px rgba(0,255,180,0.25);
        position: relative;
        z-index: 10;
        animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .logo-box {
        width: 90px;
        height: 90px;
        margin: 0 auto 15px;
        border-radius: 25px;
        background: linear-gradient(135deg, #00ffe7, var(--secondary-color));
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 34px;
        font-weight: 800;
        box-shadow: 0 0 30px rgba(0,255,200,0.45);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% {
            box-shadow: 0 0 30px rgba(0,255,200,0.45);
        }
        50% {
            box-shadow: 0 0 50px rgba(0,255,200,0.7);
        }
    }

    h2 {
        color: var(--primary-color);
        font-size: 28px;
        text-shadow: 0 0 8px rgba(0,255,150,0.45);
        margin: 10px 0 20px;
    }

    .checkmark {
        font-size: 48px;
        color: var(--primary-color);
        margin-bottom: 10px;
        animation: checkmark 0.5s ease-out;
    }

    @keyframes checkmark {
        0% {
            transform: scale(0);
        }
        50% {
            transform: scale(1.2);
        }
        100% {
            transform: scale(1);
        }
    }

    .details-box {
        margin: 22px 0;
        padding: 20px;
        border-radius: 15px;
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.12);
        font-size: 15px;
        line-height: 1.6;
        text-align: left;
    }

    .detail-row {
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .detail-row:last-child {
        margin-bottom: 0;
    }

    .detail-label {
        color: #b0b0b0;
    }

    .detail-value {
        color: var(--primary-color);
        font-weight: 600;
        word-break: break-all;
        text-align: right;
        max-width: 60%;
    }

    .message-box {
        font-size: 16px;
        margin: 25px 0;
        color: #d8d8d8;
        line-height: 1.6;
        padding: 0 5px;
    }

    .highlight {
        color: var(--primary-color);
        font-weight: bold;
    }

    /* Confetti */
    .confetti-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }

    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        opacity: 0;
        animation: fall linear forwards;
    }

    @keyframes fall {
        0% {
            transform: translateY(-50px) rotate(0deg);
            opacity: 0;
        }
        10% {
            opacity: 0.9;
        }
        100% {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
        }
    }

    /* Button Styles */
    .join-btn {
        margin-top: 28px;
        display: inline-block;
        padding: 15px 34px;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        color: #000;
        font-weight: 700;
        font-size: 17px;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 0 20px rgba(0,255,200,0.4);
        border: none;
        cursor: pointer;
    }

    .join-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 30px rgba(0,255,200,0.6);
    }

    .join-btn:active {
        transform: translateY(0);
    }

    .countdown {
        margin-top: 15px;
        color: #b0b0b0;
        font-size: 14px;
    }

    /* Loading State */
    .loading {
        display: none;
        text-align: center;
        padding: 20px;
    }

    .loading.active {
        display: block;
    }

    /* Error State */
    .error-message {
        color: #ff6b6b;
        background: rgba(255, 107, 107, 0.1);
        padding: 10px;
        border-radius: 8px;
        margin: 15px 0;
        display: none;
    }

    .error-message.active {
        display: block;
    }

    /* Responsive Design */
    @media (max-width: 480px) {
        .glass-card {
            padding: 30px 20px;
            border-radius: 20px;
        }

        h2 {
            font-size: 24px;
        }

        .details-box {
            padding: 15px;
            font-size: 14px;
        }

        .join-btn {
            padding: 14px 28px;
            font-size: 16px;
            width: 100%;
        }

        body {
            padding: 15px;
        }
    }

    @media (max-width: 350px) {
        .glass-card {
            padding: 25px 15px;
        }

        h2 {
            font-size: 22px;
        }

        .logo-box {
            width: 70px;
            height: 70px;
            font-size: 28px;
        }
    }
</style>
</head>

<body>
    <div class="confetti-container" id="confettiContainer"></div>

    <div class="glass-card">
        <div class="logo-box">MT</div>
        <div class="checkmark">âœ“</div>
        
        <h2>Payment Successful!</h2>

        <!-- Payment Details -->
        <div class="details-box">
            <div class="detail-row">
                <span class="detail-label">Amount:</span>
                <span class="detail-value" id="amount">Loading...</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Transaction ID:</span>
                <span class="detail-value" id="paymentID">Loading...</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Date:</span>
                <span class="detail-value" id="date">Loading...</span>
            </div>
        </div>

        <div class="message-box">
            <p><span class="highlight">Thank you for trusting us!</span> Your payment has been successfully processed.</p>
            <p>Welcome to the <span class="highlight">MoneyTalks family</span> â€” where smart earners thrive! ðŸš€</p>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage"></div>

        <a class="join-btn" href="https://t.me/+hN0iG3CZGmViOGY1" target="_blank" rel="noopener noreferrer" id="joinButton">
            Join Telegram Group
        </a>

        <div class="countdown" id="countdown">
            Auto-redirecting in <span id="countdownTimer">5</span> seconds...
        </div>

        <!-- Loading Spinner -->
        <div class="loading" id="loadingSpinner">
            Processing...
        </div>
    </div>

<script>
    // DOM Elements
    const amountEl = document.getElementById('amount');
    const paymentIDEl = document.getElementById('paymentID');
    const dateEl = document.getElementById('date');
    const countdownEl = document.getElementById('countdown');
    const countdownTimerEl = document.getElementById('countdownTimer');
    const errorMessageEl = document.getElementById('errorMessage');
    const joinButton = document.getElementById('joinButton');
    const confettiContainer = document.getElementById('confettiContainer');

    // Configuration
    const REDIRECT_URL = 'https://t.me/+hN0iG3CZGmViOGY1';
    const COUNTDOWN_DURATION = 5; // seconds

    // Create confetti
    function createConfetti() {
        const colors = ['#00ffae', '#8d4cff', '#00e1ff', '#fffa65'];
        const confettiCount = 50;

        for (let i = 0; i < confettiCount; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            
            // Random position and properties
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.width = (5 + Math.random() * 10) + 'px';
            confetti.style.height = (5 + Math.random() * 10) + 'px';
            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
            confetti.style.animationDuration = (2 + Math.random() * 4) + 's';
            confetti.style.animationDelay = Math.random() * 2 + 's';
            
            confettiContainer.appendChild(confetti);
            
            // Remove confetti after animation
            setTimeout(() => {
                if (confetti.parentNode === confettiContainer) {
                    confettiContainer.removeChild(confetti);
                }
            }, 6000);
        }
    }

    // Generate initial confetti
    createConfetti();

    // Generate more confetti every few seconds
    setInterval(createConfetti, 3000);

    // Parse URL parameters safely
    function getUrlParams() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                amount: urlParams.get('amount') || 'N/A',
                payment_id: urlParams.get('payment_id') || 'N/A'
            };
        } catch (error) {
            console.error('Error parsing URL parameters:', error);
            return { amount: 'N/A', payment_id: 'N/A' };
        }
    }

    // Format currency
    function formatAmount(amount) {
        if (amount === 'N/A') return amount;
        
        // Check if amount is a valid number
        const numAmount = parseFloat(amount);
        if (!isNaN(numAmount)) {
            // Add currency symbol and format to 2 decimal places
            return '$' + numAmount.toFixed(2);
        }
        
        return amount;
    }

    // Update payment details
    function updatePaymentDetails() {
        try {
            const params = getUrlParams();
            
            // Validate and format data
            amountEl.textContent = formatAmount(params.amount);
            paymentIDEl.textContent = params.payment_id;
            dateEl.textContent = new Date().toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Store data in session storage for persistence
            sessionStorage.setItem('paymentSuccessData', JSON.stringify({
                amount: params.amount,
                payment_id: params.payment_id,
                timestamp: new Date().toISOString()
            }));
            
        } catch (error) {
            console.error('Error updating payment details:', error);
            showError('Unable to load payment details. Please contact support.');
        }
    }

    // Show error message
    function showError(message) {
        errorMessageEl.textContent = message;
        errorMessageEl.classList.add('active');
    }

    // Countdown timer for auto-redirect
    function startCountdown() {
        let timeLeft = COUNTDOWN_DURATION;
        
        const timer = setInterval(() => {
            timeLeft--;
            countdownTimerEl.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                redirectToTelegram();
            }
        }, 1000);
        
        // Allow manual click to redirect immediately
        joinButton.addEventListener('click', (e) => {
            e.preventDefault();
            clearInterval(timer);
            redirectToTelegram();
        });
    }

    // Redirect function with validation
    function redirectToTelegram() {
        try {
            // Add a small delay to ensure smooth transition
            setTimeout(() => {
                window.location.href = REDIRECT_URL;
            }, 300);
        } catch (error) {
            console.error('Redirect failed:', error);
            showError('Redirect failed. Please click the button above to join manually.');
            countdownEl.style.display = 'none';
        }
    }

    // Initialize the page
    function init() {
        updatePaymentDetails();
        startCountdown();
        
        // Add a safety check for redirect
        setTimeout(() => {
            if (window.location.href.includes('success')) {
                // Still on success page after 10 seconds, show manual option
                countdownEl.innerHTML = 'You can <a href="' + REDIRECT_URL + '" style="color:#00ffae;">click here</a> to join manually.';
            }
        }, 10000);
        
        // Prevent accidental back navigation
        window.addEventListener('beforeunload', (e) => {
            // Optional: You can add a confirmation message here
            // e.preventDefault();
            // e.returnValue = '';
        });
    }

    // Start when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);

    // Handle page visibility changes
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
            // Page became visible again, recreate confetti
            createConfetti();
        }
    });
</script>
</body>
    </html>
